<Pipeline>

<description>
Align paired-end reads from two fastq files, remove all duplicates, perform local realignment around indels, and call SNP and indel variants using the GaTK.
</description>

<reference class="buffer.ReferenceFile" filename="$${Reference sequence}" />

<readsOne class="buffer.FastQFile" filename="$${First fastq file}" />
<readsTwo class="buffer.FastQFile" filename="$${Second fastq file}" />

<AlignReadsOne class="operator.bwa.BWAAligner" threads="12">
	<input>
		<reference />
		<readsOne />
	</input>
	<output >
		<readsOneSAI class="buffer.SAIFile" filename="readsOne.sai" />
	</output>
</AlignReadsOne>

<AlignReadsTwo class="operator.bwa.BWAAligner" threads="12">
	<input>
		<reference />
		<readsTwo />
	</input>
	<output >
		<readsTwoSAI class="buffer.SAIFile" filename="readsTwo.sai" />
	</output>
</AlignReadsTwo>

<CreateSAMFile class="operator.bwa.BWASampe" >
	<input>
		<reference />
		<readsOneSAI />
		<readsTwoSAI />
		<readsOne />
		<readsTwo />
	</input>
	<output>
		<readsSAM class="buffer.SAMFile" filename="simreads.sam" />	
	</output>
</CreateSAMFile>

<ConvertSamToBam class="operator.samtools.ConvertSamBam">
	<input>
		<readsSAM  class="buffer.SAMFile" filename="simreads.sam"/>
	</input>
	<output>
		<readsBAM class="buffer.BAMFile" filename="simreads.bam" />
	</output>
</ConvertSamToBam>

<RemoveDuplicates class="operator.samtools.SamtoolsRemoveDuplicates" >
	<input>
		<readsBAM class="buffer.BAMFile" filename="hapmapexome.sort.bam"/>
	</input>
	<output>
		<readsDeDupBAM class="buffer.BAMFile" filename="hapmapexome.dedup.bam" />
	</output>
</RemoveDuplicates>


<SortAndIndex class="operator.picard.CoordinateSort" createindex="true">
	<input>
		<readsBAM />
	</input>
	<output>
		<readsSorted class="buffer.BAMFile" filename="reads.dedup.sort.bam" />
	</output>
</SortAndIndex>
 
 <TargetCreator class="operator.gatk.TargetCreator" >
	<input>
		<reference />
		<readsSorted class="buffer.BAMFile" filename="hapmapexome.dedup.sort.bam"/>
	</input>
	<output>
		<targetIntervals class="buffer.CSVFile" filename="realign_targets.intervals"/>
	</output>
</TargetCreator>

<LocalIndelRealign class="operator.gatk.IndelRealign" >
	<input>
		<reference />
		<readsSorted />
		<targetIntervals />
	</input>
	<output>
		<realignedBAM class="buffer.BAMFile" filename="reads.realigned.bam" />	
	</output>
</LocalIndelRealign>

<SortAgain class="operator.picard.CoordinateSort" createindex="true">
	<input>
		<realignedBAM />
	</input>
	<output>
		<realignedResorted class="buffer.BAMFile" filename="hapmapexome.dedup.realign.bam" />
	</output>
</SortAgain>


<CallVariants class="operator.gatk.Genotyper" >
	<input>
		<reference />
		<readsSorted class="buffer.BAMFile" filename="hapmapexome.sort.bam" />
	</input>
	<output>
		<variants class="buffer.VCFFile" filename="variants.vcf" />
	</output>
</CallVariants>
 

</Pipeline>